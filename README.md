# Joupen 
whitelist  plugin for JouTak <ins>(mc.joutak.ru)</ins>

**Описание:**  
Joupen — это плагин для управления вайтлистом на сервере Minecraft. Плагин позволяет:

- Проверять подписки игроков при входе.
- Продлевать подписку.
- Начислять проходки через подарки.
- Импортировать игроков из файлов.
- Отображать информацию о проходках.

Плагин интегрируется с базой данных через `PlayerRepository` и поддерживает транзакции через `TransactionManager`.

---

## Конфигурация

- **Файл подарков:** `plugins/joupen/gifts.txt`  
  Формат строки:<ник игрока> <время>
- Примеры времени:
- `5mo` - 5 месяцев
- `3d` — 3 дня
- `2h` — 2 часа
- `7m` — 7 минут
- Можно комбинировать: `3d2h7m`

- **UUID начального игрока:** используется `INITIAL_UUID` при первой регистрации игрока.

---

## Команды

### `/joupen help`
Показывает справку по командам плагина.

### `/joupen info [<player>]`
Показывает информацию о проходке. Если указать ник игрока, нужна права `joupen.admin`.  
Пример вывода: 
"Ник Игрока: Max  
UUID Игрока: xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx  
Последняя дата продления проходки: 2025-10-12T20:30  
Проходка активна до: 2025-11-12T20:30"  
- **Формат даты:** `yyyy-MM-dd'T'HH:mm` (ISO_LOCAL_DATE_TIME). Используется для всех команд продления и подарков.

### `/joupen prolong <player> [amount] [d/m/h]`
Продлевает проходку игрока.

- `amount` — число (по умолчанию 1)
- `d/m/h` — единица времени (`d` — дни, `m` — месяцы, `h` — часы)
- Если игрока нет в базе, создаётся новая запись.

Примеры:  
/joupen prolong Max 3d → продлить на 3 дня  
/joupen prolong Max → продлить на 1 месяц (30 дней) по умолчанию  

### `/joupen addAllToWhitelist <filePath> <days>`
Импортирует игроков из файла в вайтлист на указанное количество дней.
- `filePath` — путь к текстовому файлу с никами игроков.
- `days` — количество дней продления.

### `/joupen link`
Показывает ссылку на оплату проходки.

---

## Логика работы

1. При входе игрока проверяется файл подарков и база данных.
2. Если игрока нет в базе, он не может зайти.
3. Если подписка просрочена, игроку отображается сообщение и вход запрещается.
4. Для новых UUID игрока или при первом входе выполняется корректировка даты продления (`lastProlongDate` → `validUntil`).
5. Продление через команды учитывает формат времени, указанный выше.



